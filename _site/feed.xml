<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>Escalation to zen</title>
<description>Drakmail's blog</description>
<link>http://drakmail.ru/</link>
<atom:link href="http://drakmail.ru//feed.xml" rel="self" type="application/rss+xml" />

<item>
<title>Миграция с ChilliProject на Redmine</title>
<description>&lt;h2&gt;Вступление&lt;/h2&gt;

&lt;p&gt;Всё началось примерно год назад. Redmine в то время находился в периоде стагнации в связи с тем, что часть разработчиков устроила драму и ушла пилить форк под названием ChilliProject. В тот момент я принял решение, которое и стало поводом написать этот пост - я решил перейти с Redmine на ChilliProject.&lt;/p&gt;

&lt;p&gt;Сейчас ситуация повторилась, только ChilliProject стал стагнировать, в то время как Redmine&amp;#39;овцы уже перешли на 3-и рельсы, есть планы по переходу на 4-е, большинство плагинов пилятся тоже с оглядкой только лишь на Redmine. Поэтому настало время для второго судьбоносного решения - перехода с ChilliProject обратно на Redmine.&lt;/p&gt;

&lt;h2&gt;Процесс&lt;/h2&gt;

&lt;p&gt;Собственно, с лирической частью закончено. Теперь о самом процессе. Так как ChilliProject у нас работает на продакшене, с достаточно большой базой тикетов, страниц wiki, файлов и документов, делать перенос сразу на продакшене несколько страшно. Поэтому проще всего использовать vagrant для миграции на локальной машине, а после - проверить, всё ли смигрировало нормально и просто закинуть базу и файлы на продакшен.&lt;/p&gt;

&lt;h3&gt;Шаг 1. Инициализация vagrant&lt;/h3&gt;

&lt;p&gt;Так как на продакшене используется debian, образ vagrant&amp;#39;а лучше всего использовать тоже debian&amp;#39;овский. Это позволит избежать различных косяков при перекидывании. Добавление 64-х битного debian 7.2 делается очень просто:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;text&quot;&gt;vagrant box add debian7.2 https://dl.dropboxusercontent.com/u/197673519/debian-7.2.0.box
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Далее требуется инициализировать новую виртуалку с debian:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;text&quot;&gt;vagrant init debian7.2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;И профорвардить 3000-й порт для тестирования всего этого. Для этого надо раскомментировать и чуть изменить строчку Vagrantfile:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;text&quot;&gt;# config.vm.network :forwarded_port, guest: 80, host: 8080
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;заменить на&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;text&quot;&gt;config.vm.network :forwarded_port, guest: 3000, host: 3030
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Шаг 2. Воссоздание среды&lt;/h3&gt;

&lt;p&gt;Ничего сложного, просто ставим Postgres, rvm (по хорошему, надо бы сменить его на chruby, но лень), imagemagick и bundler:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;text&quot;&gt;vagrant up
vagrant ssh
sudo su
dpkg-reconfigure locales
exit
sudo su -l # refresh locale settings
apt-get update &amp;amp;&amp;amp; apt-get upgrade
apt-get install postgresql-9.1 postgresql-server-dev-9.1 libmagickwand-dev vim
adduser --force-badname --home /var/www/delta-zet.com/data/ delta-zet.com # add user as on the primary server
su -l delta-zet.com
\curl -L https://get.rvm.io | bash -s stable
source ~/.bashrc
source ~/.bash_profile
rvm autolibs disable # to disable sudo
rvm install 2.0.0
gem install bundler
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Шаг 3. Установка Redmine&lt;/h3&gt;

&lt;p&gt;Тут вообще всё просто:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;text&quot;&gt;sudo su -l postgres
psql
create user &amp;quot;delta-zet.com&amp;quot; with password &amp;#39;123456&amp;#39;;
create database redmine with owner &amp;quot;delta-zet.com&amp;quot;;
\q
exit
su -l delta-zet.com
wget -O redmine.tar.gz http://www.redmine.org/releases/redmine-2.4.1.tar.gz
tar -xvf redmine.tar.gz
ln -s redmine-2.4.1/ redmine
cd redmine
cp config/database.yml.example config/database.yml
vim config/database.yml
bundle install --without development test
rake generate_secret_token
RAILS_ENV=production rake db:migrate
RAILS_ENV=production REDMINE_LANG=ru rake redmine:load_default_data
mkdir -p tmp tmp/pdf public/plugin_assets
chown -R delta-zet.com:delta-zet.com files log tmp public/plugin_assets
chmod -R 755 files log tmp public/plugin_assets
ruby script/rails server webrick -e production
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;После этого можно убедиться, что всё работает. Теперь начинается самая интересная часть - перенос.&lt;/p&gt;

&lt;h3&gt;Шаг 4. Миграция&lt;/h3&gt;

&lt;p&gt;Сначала задампим БД ChilliProject&amp;#39;а:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;text&quot;&gt;pg_dump redmine &amp;gt; redmine.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;И импортируем его в vagrant, предварительно очистив тестовую таблицу:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;text&quot;&gt;sudo su -l postgres
psql
drop database redmine;
create database redmine with owner &amp;quot;delta-zet.com&amp;quot;;
\q
exit
sudo su -l delta-zet.com
psql redmine &amp;lt; redmine.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Правки структуры...&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;text&quot;&gt;psql redmine
ALTER TABLE journals RENAME COLUMN created_at TO created_on;
ALTER TABLE journals RENAME COLUMN activity_type TO journalized_type;
ALTER TABLE journals RENAME COLUMN journaled_id TO journalized_id;
UPDATE journals SET journalized_type=&amp;#39;Issue&amp;#39; WHERE journalized_type=&amp;#39;issues&amp;#39;;
ALTER TABLE wiki_contents ADD comments VARCHAR(250) NULL;
ALTER TABLE journals RENAME COLUMN changes TO changes_chilli;
ALTER TABLE journals DROP COLUMN type;
ALTER TABLE journals DROP COLUMN version;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Затем запускаем миграции...&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;text&quot;&gt;RAILS_ENV=production rake db:migrate
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Потом просто затариваем директорию, переносим files, прописываем заново workflow&amp;#39;ы, так как они почему-то не смигрировали и радуемся :)&lt;/p&gt;

&lt;h2&gt;Заключение&lt;/h2&gt;

&lt;p&gt;TODO: Добавить заключение :D&lt;/p&gt;
</description>
<pubDate>Sun, 24 Nov 2013 00:00:00 +0400</pubDate>
<link>http://drakmail.ru//2013/11/24/migrate-from-chilliproject-to-redmine.html</link>
<guid isPermaLink="true">http://drakmail.ru//2013/11/24/migrate-from-chilliproject-to-redmine.html</guid>
</item>

<item>
<title>Конец СМС спама? Операторы поднимают цены на отправку СМС через свои шлюзы.</title>
<description>&lt;p&gt;Иногда требуется прикрутить рассылку СМС для клиентов какой-нибудь компании. После того, как нашел сервис, отправляющий СМС-ки за 7 копеек с первой СМС, думал, что теперь-то уже точно цены на СМС не будут расти. А теперь очень интересное письмо пришло сегодня от littlesms, с которыми наша компания когда-то работала:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Здравствуйте!&lt;/p&gt;

&lt;p&gt;Спасибо, что пользуетесь нашим сервисом. Cообщаем Вам важную информацию.&lt;/p&gt;

&lt;p&gt;В сфере смс-услуг в России ожидаются серьезные изменения, которые вводятся самими операторами для борьбы со спамом, что повлечет большое повышение цен на смс. Операторы начнут закрываться друг от друга и пропускать коммерческие рассылки только через свое прямое подключение по более высоким ценам.&lt;/p&gt;

&lt;p&gt;Сейчас все сервисы могут отправлять сообщения по всей России через одного любого оператора по фиксированной цене. В связи с этим некоторые региональные операторы из-за конкуренции и нулевой себестоимости стали предлагать очень низкие цены на отправку сообщений, поэтому через них сейчас отправляется большое количество спама, с которым федеральные операторы пытаются бороться.&lt;/p&gt;

&lt;p&gt;Слухи об этом ходили давно, но только недавно информация начала уточняться. По имеющимся данным с 01.11.2013 операторы Мегафон и Теле2 вводят ограничения на пропуск трафика в свои сети от других операторов и поднимают цены на смс через свои подключения, Билайн и МТС планируют сделать это с 01.01.2014.&lt;/p&gt;

&lt;p&gt;Ограничения должны коснуться в первую очередь сообщений, отправляемых от буквенных имен и коротких номеров, отправка с мобильных номеров, принадлежащих диапазонам оператора отправителя, не должна блокироваться, но возможны также блокировки сообщений с определенных номеров по черным спискам или по тексту сообщений. Также могут полностью блокироваться смс-центры региональных операторов, как основные распространители спама.&lt;/p&gt;

&lt;p&gt;Информация об этом есть в открытых источниках, например, здесь http://www.3dnews.ru/767257/&lt;/p&gt;

&lt;p&gt;Наш сервис использует подключения более крупного провайдера, который прямое подключение к оборудованию Билайн, трафик которого не должен полностью блокироваться другими операторами, но отправка с буквенных имен также может быть заблокирована.&lt;/p&gt;

&lt;p&gt;Оператор Tele2 предоставляет временный адаптационный период, и цены повышает ненамного, но на него будет требоваться предварительная регистрация буквенных имен (более долгая модерация имен).&lt;/p&gt;

&lt;p&gt;Оператор Мегафон повышает цены значительно и планирует ввести платную регистрацию имен отправителей.&lt;/p&gt;

&lt;p&gt;В связи с этим в качестве переходного периода на более высокие тарифы отправка в нашем сервисе на операторов, которые вводят фильтры и значительно повышают цены, будет происходить от мобильного номера оператора Билайн. Если операторы действительно не будут блокировать смс-сообщения от мобильных номеров, то можно будет отправлять такие сообщения по старым тарифам до момента повышения цен у самого Билайна. В таком случае рекомендуем подключать свой номер у этого оператора и использовать его для смс-рассылок по более низким ценам.&lt;/p&gt;

&lt;p&gt;С уважением,
Команда LittleSMS.ru&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;В принципе, я думаю, СМС спама, в следствии этого, должно будет стать чуть меньше.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Обновление:&lt;/strong&gt; такое же письмо пришло и от СМС-центра. Судя по всему, скоро всех накроет.&lt;/p&gt;
</description>
<pubDate>Fri, 25 Oct 2013 00:00:00 +0400</pubDate>
<link>http://drakmail.ru//2013/10/25/end-of-sms.html</link>
<guid isPermaLink="true">http://drakmail.ru//2013/10/25/end-of-sms.html</guid>
</item>

<item>
<title>Новый каталог JavaScript скриптов (включая плагины jQuery)</title>
<description>&lt;p&gt;Наткнулся сегодня на Hacker News на вот такой вот &lt;a href=&quot;%D0%BE%D1%84%D0%B8%D0%B3%D0%B5%D0%BD%D0%BD%D0%B5%D0%B9%D1%88%D0%B8%D0%B9%20%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81&quot;&gt;http://www.unheap.com&lt;/a&gt;. Из минусов - очень многое хочет jQuery. Не удержался, попробовал пару новых фишек на этом блоге - теперь тут есть &lt;a href=&quot;https://github.com/jeromeetienne/jquery-qrcode&quot;&gt;показ QR кода на страницу&lt;/a&gt; и &lt;a href=&quot;http://darcyclarke.me/dev/repojs/&quot;&gt;просмотр исходника блога&lt;/a&gt;.&lt;/p&gt;
</description>
<pubDate>Fri, 03 May 2013 00:00:00 +0400</pubDate>
<link>http://drakmail.ru//2013/05/03/unheap-js-is-javascript-collection.html</link>
<guid isPermaLink="true">http://drakmail.ru//2013/05/03/unheap-js-is-javascript-collection.html</guid>
</item>

<item>
<title>Установка chruby + ruby 2.0 одной командой</title>
<description>&lt;script src=&quot;https://gist.github.com/drakmail/5507520.js&quot;&gt;&lt;/script&gt;
</description>
<pubDate>Fri, 03 May 2013 00:00:00 +0400</pubDate>
<link>http://drakmail.ru//2013/05/03/install-chruby-in-one-command.html</link>
<guid isPermaLink="true">http://drakmail.ru//2013/05/03/install-chruby-in-one-command.html</guid>
</item>

<item>
<title>Подключение HP принтера с использованием SAMBA в Linux через CUPS</title>
<description>&lt;p&gt;Принтеры HP меня приятно удивили. Всё оказалось просто и понятно. Ниже краткая заметка, чтобы не гуглить лишний раз команду просмотра списка SAMBA ресурсов.&lt;/p&gt;

&lt;p&gt;Смотрим список принтеров на SAMBA-сервере:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;smbclient -L 192.168.0.227 -U admin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Пример:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;text&quot;&gt;$ smbclient -L 192.168.0.227 -U drakmail
Enter drakmail&amp;#39;s password: 
Domain=[SERVDPSROOT] OS=[Windows Server 2003 3790 Service Pack 2] Server=[Windows Server 2003 5.2]

    Sharename       Type      Comment
    ---------       ----      -------
    print$          Disk      Драйверы принтеров
    ....
    HPLaserJ        Printer   HP LaserJet M1522 MFP Series PCL 6

session request to 192.168.0.227 failed (Called name not present)
session request to 192 failed (Called name not present)
Domain=[SERVDPSROOT] OS=[Windows Server 2003 3790 Service Pack 2] Server=[Windows Server 2003 5.2]

    Server               Comment
    ---------            -------

    Workgroup            Master
    ---------            -------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Собственно, в CUPS дальше всё как обычно:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013-03-27/1.png&quot; alt=&quot;Управление принтерами&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013-03-27/2.png&quot; alt=&quot;Добавление принтера&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013-03-27/3.png&quot; alt=&quot;Ввод данных нового принтера&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013-03-27/4.png&quot; alt=&quot;Продолжение ввода данных нового принтера&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013-03-27/5.png&quot; alt=&quot;Выбор .ppd файла для принтера&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013-03-27/6.png&quot; alt=&quot;Указание стандратных опций печати&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013-03-27/7.png&quot; alt=&quot;Информационная страница&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013-03-27/8.png&quot; alt=&quot;Печать тестовой страницы&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013-03-27/9.png&quot; alt=&quot;ИНформационная страница&quot;&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 27 Mar 2013 00:00:00 +0400</pubDate>
<link>http://drakmail.ru//2013/03/27/connecting-hp-printer-to-linux-with-cups.html</link>
<guid isPermaLink="true">http://drakmail.ru//2013/03/27/connecting-hp-printer-to-linux-with-cups.html</guid>
</item>

<item>
<title>MPL 1.1 - опасная лицензия</title>
<description>&lt;p&gt;Вчера ночью нашел хороший почтовый клиент, форк Thunderbird - &lt;a href=&quot;http://www.postbox-inc.com&quot;&gt;Postbox&lt;/a&gt;. На радостях побежал собирать его из исходников, уже начал писать пост про это даже, как вдруг - выяснилось ужасное. MPL 1.1 (под которой распространяется Thunderbird и Postbox) требует открытия только измененной части исходников, новые же файлы, добавленные в проект, эта лицензия позволяет выпускать под любой другой, в том числе проприетарной, лицензией. Цитата из &lt;a href=&quot;http://www.mozilla.org/MPL/1.1/#section-3.7&quot;&gt;MPL&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;3.7. Larger Works.&lt;/p&gt;

&lt;p&gt;You may create a Larger Work by combining Covered Code with other code not governed by the terms of this License and distribute the Larger Work as a single product. In such a case, You must make sure the requirements of this License are fulfilled for the Covered Code. &lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Из-за этого собственные допиливания Thunderbird, сделанные в Postbox, закрыты под проприетарной лицензией и не выложены в дистрибутив исходников, из-за чего собрать выложенный тарбол postbox просто невозможно. &lt;/p&gt;
</description>
<pubDate>Sun, 24 Mar 2013 00:00:00 +0400</pubDate>
<link>http://drakmail.ru//2013/03/24/mpl1.1-is-evil.html</link>
<guid isPermaLink="true">http://drakmail.ru//2013/03/24/mpl1.1-is-evil.html</guid>
</item>

<item>
<title>AirPrint и Brother HL-2035</title>
<description>&lt;p&gt;Решил наконец подключить свой принтер к AirPrint Express для сетевой печати. Из приятного - после подключения сразу же принтер определился под макосью, быстро сам скачал драйверы и стал готов к печати. Под линуксом тоже не намного сложнее - указал IP AirPort Express, подсунул ppd файл, всё заработало. А вот заюзать принтер из iOS не получится таким образом - из коробки работать будет только принтер, подключенный по wifi/ethernet, и у которого прошивка поддерживает AirPrint. У меня ни одно из этих условий не соблюдено, а единственный возможнный костыль - приложение в AppStore - производитель писать не хочет.  Собственно, был бы Android, то, наверное, можно было бы печатать и с телефона/планшета. Благо, мне это не настолько нужно :) &lt;/p&gt;

&lt;h2&gt;Update: Счастливый финал&lt;/h2&gt;

&lt;p&gt;Только что нашел способ заставить работать AirPrint в iOS с любым принтером - классная программа &lt;a href=&quot;http://www.netputing.com/applications/handyprint-v4-1/&quot;&gt;HandyPrint&lt;/a&gt;. После установки в центре настроек появляется новый пункт, где нужно поставить всего 1 галочку, чтобы доступный на Mac OS X принтер расшарился через AirPrint. Очень удобно :)&lt;/p&gt;
</description>
<pubDate>Thu, 21 Mar 2013 00:00:00 +0400</pubDate>
<link>http://drakmail.ru//2013/03/21/airprint-brother-hl-2035.html</link>
<guid isPermaLink="true">http://drakmail.ru//2013/03/21/airprint-brother-hl-2035.html</guid>
</item>

<item>
<title>Миграция с tumblr на jekyll</title>
<description>&lt;p&gt;В связи с недавними новостями о &lt;a href=&quot;http://googleblog.blogspot.ru/2013/03/a-second-spring-of-cleaning.html&quot;&gt;закрытии Google Reader&lt;/a&gt;, решил всё-таки начать отвязываться от облачных серверов. В принципе, так как кроме блога я ничего не размещаю на чужих ресурсах, он и стал сегодняшней утренней жертвой. Да и вообще tumblr явно не совпадает с моим видением блогоплатформы.&lt;/p&gt;

&lt;p&gt;Сама по себе миграция очень проста, если не брать в расчет некоторые подводные камни:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gem install jekyll
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;jekyll new blog
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ruby -rubygems -e &lt;span class=&quot;s1&quot;&gt;&amp;#39;require &amp;quot;jekyll/migrators/tumblr&amp;quot;; Jekyll::Tumblr.process(&amp;quot;http://www.your_blog_url.com&amp;quot;)&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Но дьявол, как известно, в деталях :)&lt;/p&gt;

&lt;h2&gt;Проблемы&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Проблема номер раз:&lt;/strong&gt; jekyll говорил при попытке импорта 404. Как оказалось, тут всё просто, имя блога необходимо обязательно указывать без &lt;code&gt;/&lt;/code&gt; в конце :)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Проблема номер два:&lt;/strong&gt; после указания правильного URL для jekyll, уже ruby ругался на непонятный метод &lt;code&gt;at&lt;/code&gt;, который применяется к хешу (что-то вроде &lt;code&gt;undefined method &amp;#39;at&amp;#39; for #&amp;lt;Hash&lt;/code&gt;). Что это и зачем он там - неясно. Правим исходники (&lt;code&gt;lib/ruby/gems/2.0.0/gems/jekyll-import-0.1.0.beta1/lib/jekyll/jekyll-import/tumblr.rb&lt;/code&gt;) руками:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;          &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;id3-title&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil?&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;title&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;id3-title&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;at&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;audio-player&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;&amp;lt;br/&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;audio-caption&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;title&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;audio-caption&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;at&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;audio-player&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;заменяем на&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;          &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;id3-title&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil?&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;title&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;id3-title&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;audio-player&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;&amp;lt;br/&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;audio-caption&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;title&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;audio-caption&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;audio-player&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Проблема номер три:&lt;/strong&gt; при попытке импорта в markdown выскакивает вот такая ошибка: &lt;code&gt;in &amp;#39;gsub!&amp;#39;: invalid byte sequence in UTF-8&lt;/code&gt;. Как оказалось, html2text, который нужен для импорта в markdown, не умеет работать с UTF-8 без патчей. Решение - отказаться от импорта в markdown :)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Проблема номер четыре,&lt;/strong&gt; которая хоть и не проблема вовсе, но напрягает: адреса постов после импорта имели страшный вид (&lt;code&gt;---_--_.html&lt;/code&gt;, примерно такой). Я это поправил быстропатчем:&lt;/p&gt;

&lt;p&gt;Шаг 1. Устанавливаем gem russian&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gem install russian
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Шаг 2. Правим код, добавляя транслитерацию заголовка&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# В начало&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;russian&amp;#39;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# В район 100-й строки, где генерируется slug&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# заменяем slug = title.downcase.strip.gsub(&amp;#39; &amp;#39;, &amp;#39;-&amp;#39;).gsub(/[^\w-]/, &amp;#39;&amp;#39;) на&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;slug&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Russian&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;translit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;downcase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strip&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gsub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;-&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gsub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/[^\w-]/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Собственно, на этом проблемы заканчиваются, и можно спокойно использовать &lt;a href=&quot;https://github.com/mojombo/jekyll&quot;&gt;jekyll&lt;/a&gt;.&lt;/p&gt;
</description>
<pubDate>Wed, 20 Mar 2013 00:00:00 +0400</pubDate>
<link>http://drakmail.ru//2013/03/20/move-from-tumblr-to-jekyll.html</link>
<guid isPermaLink="true">http://drakmail.ru//2013/03/20/move-from-tumblr-to-jekyll.html</guid>
</item>

<item>
<title>Блоги rails</title>
<description>&lt;p&gt;Два интересных, но медленно обновляющихся блога по Ruby on Rails.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://my.rails-royce.org/&quot;&gt;La rolls des blogs&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.drinkrails.com/&quot;&gt;Drink Rails&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.rubyflow.ru/&quot;&gt;Ruby Flow&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Fri, 03 Aug 2012 00:00:00 +0400</pubDate>
<link>http://drakmail.ru//2012/08/03/blogi-rails.html</link>
<guid isPermaLink="true">http://drakmail.ru//2012/08/03/blogi-rails.html</guid>
</item>

<item>
<title>jQuery плагин для красивых placeholder</title>
<description>&lt;a href=&quot;https://github.com/remybach/jQuery.superLabels&quot;&gt;jQuery плагин для красивых placeholder&lt;/a&gt;&lt;br/&gt;&lt;p&gt;Очень классно сделано. Обязательно смотреть &lt;a href=&quot;http://remy.bach.me.uk/superlabels_demo/&quot;&gt;демо&lt;/a&gt;, чтобы понять, как это работает.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://img59.imageshack.us/img59/396/labels.gif&quot; alt=&quot;видео работы&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Tue, 31 Jul 2012 00:00:00 +0400</pubDate>
<link>http://drakmail.ru//2012/07/31/jquery-plagin-dlya-krasivyh-placeholder.html</link>
<guid isPermaLink="true">http://drakmail.ru//2012/07/31/jquery-plagin-dlya-krasivyh-placeholder.html</guid>
</item>

</channel>
</rss>